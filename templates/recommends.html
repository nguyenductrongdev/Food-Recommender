{% extends 'base.html' %}

{% block style %}
<style>
    a:hover {
        text-decoration: none;
    }

    .recommend-cluster {
        cursor: pointer;
    }

    .recommend-cluster:hover {
        background-color: #eee !important;
    }
</style>
{% endblock %}

{% block main %}
<div class="container" style="min-height: 90vh !important;">
    <div class="row">
        <div class="col-12">
            <h1 class="section-header">Các gợi ý mua chung</h1>

            <div id="main-content">

            </div>

            <script>
                (async function () {
                    let response = await fetch("/api/nguoi-dung/goi-y-mua-chung", {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                    })
                    let data = await response.json();
                    let recommendData = data.recommend_data;

                    let presentHTML = "";
                    console.log({ recommendData });
                    let uniKeyCount = 0;
                    for (const tp_ma in recommendData) {
                        console.log(`Generate for ${tp_ma}`);

                        presentHTML += `<h4>TP_MA: ${tp_ma}</h4>`;
                        // show cluster one by one
                        for (let cluster_index = 0; cluster_index < recommendData[tp_ma].length; cluster_index++) {
                            const clsuters = recommendData[tp_ma][cluster_index];
                            // cluster item is ctdkm
                            console.log(`clsuters`, clsuters);

                            _id = `uuid-${++uniKeyCount}`;


                            presentHTML += `<div class='bg-light p-3 rounded shadow-sm d-flex justify-content-start align-items-center recommend-cluster' data-toggle='modal' data-target='#${_id}'>`;

                            presentHTML += clsuters.map(node => `
                                <span class="d-inline-block p-2 m-2 w-25 border">${node.detail.ND_TAI_KHOAN}</span>
                            `).join('');

                            presentHTML += "</div>";

                            // add modal head
                            presentHTML += `
                            <div class="modal fade" id="${_id}" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
                                <div class="modal-dialog modal-dialog-centered" role="document">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title" id="exampleModalCenterTitle">Xác nhận mua chung</h5>
                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                <span aria-hidden="true">&times;</span>
                                            </button>
                                        </div>`

                            // add modal body
                            presentHTML += `<div class="modal-body">`;
                            presentHTML += `<div>Bạn đồng ý mua chung với ${clsuters.map(node => '<b>' + node.detail.ND_TAI_KHOAN + '</b>').join(', ')}?</div>`
                            presentHTML += `</div>`;

                            // add model foot
                            presentHTML += `
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                            <button type="button" class="btn btn-primary" data-tp_ma="${tp_ma}" data-cluster_index=${cluster_index}>Đồng ý</button>
                                        </div>
                                    </div>
                                </div>
                            </div>`;

                            presentHTML += "<br />"
                        }

                    }

                    $("#main-content").html(presentHTML);
                })();
            </script>


        </div>
    </div>
</div>
{% endblock %}

{% block script %}
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

<script>
    $(function () {


    });
</script>
{% endblock %}