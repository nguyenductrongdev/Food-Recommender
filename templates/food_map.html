{% extends 'base.html' %}

{% block style %}
<style>
    .product {
        display: flex;
        flex-direction: column;
        height: 50vh;
    }

    .product__image {
        width: 100%;
        height: 45%;
        object-fit: cover;
    }

    .section-header {
        border-left: 1.5vw solid orange;
        padding: 1vw 2vw;
        margin: 1vw 0;
    }
</style>
{% endblock %}



{% block main %}
<div class="container">
    <div class="shadow" id="map" style="height:90vh"></div>
</div>
{% endblock %}

{% block script %}
<!-- Bootstrap -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<!-- Mapbox -->
<script src="https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.js"></script>
<link href="https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.css" rel="stylesheet" />

<script>
    mapboxgl.accessToken =
        "pk.eyJ1IjoidnVseXRoaWVuYW5oIiwiYSI6ImNrZXlhNXd3ZDBkb2Myd3AzYWRxaXhodnIifQ.de-6twccJ_8Jte2Iy5xVqg";

    function successLocation(position) {
        setupMap([position.coords.longitude, position.coords.latitude]);
    }

    function errorLocation() {
        setupMap([105.7225509, 10.0342696]);
    }

    navigator.geolocation.getCurrentPosition(successLocation, errorLocation, {
        enableHighAccuracy: true
    });

    function setupMap(center) {
        var map = new mapboxgl.Map({
            container: "map",
            style: "mapbox://styles/mapbox/streets-v11",
            center: center,
            zoom: 10,
        });

        {%for local in range(0, lengthLocation) %}
        var marker{{ local+1
    }} = new mapboxgl.Marker()
        .setLngLat([{{ geo_location_list[local].longitude }}, {{ geo_location_list[local].latitude }}])
        .setPopup(new mapboxgl.Popup({ offset: 25 }) // add popups
            .setHTML(
                `<div>
                    <h6>Thông tin</h6>
                    <p>Danh mục: {{ information_in_location[local].DMTP_TEN }}<p>
                    <p>Số lượng: {{ information_in_location[local].TP_SO_LUONG}} {{ information_in_location[local].DMDVT_TEN}}</p>
                    <p>Ngày bán: {{ information_in_location[local].TP_NGAY_BAN }}<p>
                </div>`
            ))
        .addTo(map);
    {% endfor %}

    // Add geolocate control to the map.
    map.addControl(
        new mapboxgl.GeolocateControl({
            positionOptions: {
                enableHighAccuracy: true
            },
            trackUserLocation: true
        })
    );
    }


</script>
{% endblock %}